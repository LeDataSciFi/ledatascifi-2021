
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Outline &#8212; LeDataSciFi-2021</title>
    
  <link rel="stylesheet" href="../../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/fin377_specialformatting.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../index.html">
  
  <img src="../../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">LeDataSciFi-2021</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  About the class
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/objectives.html">
   Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/outcomes.html">
   Outcomes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/about_us.html">
   About us + office hours
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/structure_and_policies.html">
   Course structure + policies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/gradeoverview.html">
   Grading
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/acknowledgments.html">
   Gratitude
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Schedule, tips, resources
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/schedule.html">
   Dashboard, key links, schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/resources.html">
   Help + resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/tips.html">
   Tips and hacks
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Assignments and participation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/howto_do.html">
   How to start and turn in assignments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/howto_review.html">
   How to do your peer reviews
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Textbook
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../01/00_Getting_Started.html">
   1. Motivation and Getting Started
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/01_Motivation.html">
     1.1. Motivation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/02_Setup.html">
     1.2. Set up
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/03_github.html">
     1.3. Github Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/04_Markdown.html">
     1.4. Markdown basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/05_jupyterlab.html">
     1.5. Jupyter Lab Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/06_python.html">
     1.6. Python Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/07_debugging.html">
     1.7. Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/07a_errors.html">
     1.8. Errors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/08_libraries.html">
     1.9. Installing libraries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/09_gitignore.html">
     1.10. Gitignore Files
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../02/10_Golden_1.html">
   2. Good Analysis Practices
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../02/10_Golden_2.html">
     2.1. A case study of bad research
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02/10_Golden_3.html">
     2.2. The golden rules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02/10_Golden_4.html">
     2.3. Good data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02/10_Golden_5.html">
     2.4. When to write functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02/10_Golden_6.html">
     2.5. Reorganizing the bad research folder
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02/10_Golden_7.html">
     2.6. Filepaths
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../03/00_Data_Wrangling_Intro.html">
   3. Wrangling with Data
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../03/01_Numpy.html">
     3.1. Numpy
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/01a_NumpyCS.html">
       3.1.1. Numpy + Scientific Computing
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/01b_NumpyBasics.html">
       3.1.2. A (Very) Short Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/01c_NumpyPractice.html">
       3.1.3. Exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/01d_NumpyResources.html">
       3.1.4. More Resources
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/01d_NumpyResources.html#survey">
       3.1.5. Survey
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../03/02a_pandasIntro.html">
     3.2. Pandas
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/02a_pandasTips.html">
       3.2.1. Tips
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/02b_pandasVocab.html">
       3.2.2. Vocab and Long vs Wide Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/02c_commonFcns.html">
       3.2.3. Common Functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/02d_temp.html">
       3.2.4. Temp. vs Perm. Objects
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/02e_eda_golden.html">
       3.2.5. Golden Rules + EDA
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/02f_chains.html">
       3.2.6. Pandas Chains
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/02g_commontasks.html">
       3.2.7. Common Tasks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/02h_exercises.html">
       3.2.8. Exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/02j_resourcesAndSum.html">
       3.2.9. Summary and Resources
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../03/04a-dataviz.html">
     3.3. Data Visualization
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/04b-whyplot.html">
       3.3.1. The Role of Viz in Analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/04c-makeplot.html">
       3.3.2. Making a Plot
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/04d-whichplot.html">
       3.3.3. Which Plot Type Should I Use?
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/04e-visualEDA.html">
       3.3.4. Visual EDA
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/04f-betterplots.html">
       3.3.5. Better Plots
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../03/05a-otherskills.html">
     3.4. Other (Important) Data Wrangling Skills
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/05b_merging.html">
       3.4.1. Merging
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../03/05c_missingdata.html">
       3.4.2. Dealing with Missing Data
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../00_World_Wide_Data.html">
   4. Accessing the World of Data
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../01_Intro_to_scraping.html">
     4.1. Getting Data off the Web
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01a_openingAndParsing.html">
     4.2. Opening + Parsing
     <em>
      a
     </em>
     Webpage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01b_spiders.html">
     4.3. Building a spider
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/content/04/old/01_Intro_to_scraping.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/LeDataSciFi/ledatascifi-2021"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/LeDataSciFi/ledatascifi-2021/issues/new?title=Issue%20on%20page%20%2Fcontent/04/old/01_Intro_to_scraping.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/LeDataSciFi/ledatascifi-2021/edit/main/content/04/old/01_Intro_to_scraping.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/LeDataSciFi/ledatascifi-2021/main?urlpath=lab/tree/content/04/old/01_Intro_to_scraping.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/LeDataSciFi/ledatascifi-2021/blob/main/content/04/old/01_Intro_to_scraping.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Outline
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ways-to-get-data-from-the-web">
   Ways to get data from the web
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wisdom-from-greg-reda-that-applies-to-all-of-these">
     Wisdom from Greg Reda that applies to all of these:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#which-method-should-you-choose">
     Which method should you choose?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-scraping-toolkit">
   A scraping toolkit
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#useful-packages-tricks-and-tips">
     Useful packages, tricks, and tips
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#my-suggestion">
     My suggestion
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-skills-do-i-need-to-learn-to-be-a-master-hacker-wo-man">
     What skills do I need to learn to be a master Hacker(wo)man?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#skill-1-retrieving-urls-and-sending-manual-api-queries">
   Skill #1: Retrieving URLs and sending manual API queries
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#skill-2-how-to-parse-a-single-page">
   Skill 2: How to parse a (single) page
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practice">
     Practice
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practice-challenge-get-a-list-of-wiki-pages-for-s-p500-firms">
     Practice/challenge: Get a list of wiki pages for S&amp;P500 firms
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#after-class-practice">
     AFTER CLASS PRACTICE
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#skill-3-building-a-scraper">
   Skill #3: Building a scraper
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#one-api-hit-is-cool-but-do-you-know-whats-really-cool">
     One API hit is cool, but  do you know whats really cool?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-main-web-scraping-problems-and-workarounds">
   The main web scraping problems (and workarounds)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#issue-1-the-jobs-are-slow">
     Issue 1:  The jobs are slow
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#issue-2-too-much-speed">
     Issue 2: Too much speed
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#issue-3-so-i-m-downloading-a-loooot-of-files">
     Issue 3: So… I’m downloading a loooot of files
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#summary">
     Summary
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#would-you-like-another-tutorial-to-try">
     Would you like another tutorial to try?
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Practice
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#footnotes">
   Footnotes
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#credits">
   Credits
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="outline">
<h1>Outline<a class="headerlink" href="#outline" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>Overview of different ways to get data</p></li>
<li><p>API: description, demo, practice</p></li>
</ol>
</div>
<div class="section" id="ways-to-get-data-from-the-web">
<h1>Ways to get data from the web<a class="headerlink" href="#ways-to-get-data-from-the-web" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p><strong>Manually click and download.</strong> The way you would have done it before this class.</p></li>
<li><p><strong>Let <code class="docutils literal notranslate"><span class="pre">pandas</span></code> download.</strong> E.g. our assignments often begin with <code class="docutils literal notranslate"><span class="pre">pd.read_stata(&lt;url&gt;)</span></code>.</p>
<ul class="simple">
<li><p>Did you know? Pandas can often directly read tables on webpages! Try <code class="docutils literal notranslate"><span class="pre">pd.read_html('https://en.wikipedia.org/wiki/List_of_S%26P_500_companies')</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_html</span></code> can only handle basic HTML tables encoded directly in the page (no Javascript, e.g.) and only grabs displayed text – no URLS.</p></li>
<li><p>You can use the data without saving it to your hard drive if you want. The good/bad part of this is that if the website changes the data, the next time you run it, you’ll get the newer version of data. (Unstable, potentially, but also updates automatically.)</p></li>
</ul>
</li>
<li><p><strong>“Install and play” APIs</strong>, which let you interact with a website without specifying the exact API requests. API stands for Application Programming Interface, and it is a way for your computer to send a request (a query) to a server and get some response (hopefully useful data).</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">pandas_datareader</span></code> plug in for Yahoo stock prices is one version of this.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">datadotworld</span></code> was another.</p></li>
<li><p>Kaggle and most of the <a class="reference external" href="https://ledatascifi.github.io/studentresourcevert/resource-landing.html#getting-data-and-practicing-ml">data sources listed on our main site</a> have API packages for Python.</p></li>
<li><p>I download your peer reviews using <code class="docutils literal notranslate"><span class="pre">PyGithub</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Manual API queries</strong> for websites without “install and play” APIs. Many sites have an API port of some kind serving up the data they show visitors.</p></li>
<li><p><strong>Scraping the data implicitly on the website.</strong> The last resort. You can’t find the API serving the data, but your eyes see it. And you want it, cause websites contain a lot of data, like <a class="reference external" href="https://www.imdb.com/title/tt0944947/?ref_=nv_sr_srsg_0">GoT’s IMDB page</a>.</p>
<ul class="simple">
<li><p>AGAIN: The last resort.</p></li>
</ul>
</li>
</ol>
<div class="section" id="wisdom-from-greg-reda-that-applies-to-all-of-these">
<h2>Wisdom from <a class="reference external" href="http://www.gregreda.com/2013/03/03/web-scraping-101-with-python/">Greg Reda</a> that applies to all of these:<a class="headerlink" href="#wisdom-from-greg-reda-that-applies-to-all-of-these" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ol class="simple">
<li><p>You should check a site’s terms and conditions before you scrape them. It’s their data and they likely have some rules to govern it.</p></li>
<li><p>Be nice - A computer will send web requests much quicker than a user can. Make sure you space out your requests a bit so that you don’t hammer the site’s server.</p></li>
<li><p>Scrapers break - Sites change their layout all the time. If that happens, be prepared to rewrite your code.</p></li>
<li><p>Web pages are inconsistent - There’s sometimes some manual clean up that has to happen even after you’ve gotten your data.</p></li>
</ol>
</div></blockquote>
</div>
<div class="section" id="which-method-should-you-choose">
<h2>Which method should you choose?<a class="headerlink" href="#which-method-should-you-choose" title="Permalink to this headline">¶</a></h2>
<p><strong>Options 1-3 are BY FAR the easiest.</strong> If you want more than 10 tables or so (but the threshold depends on your coding speed), I’d abandon the manual option and go with <code class="docutils literal notranslate"><span class="pre">pandas</span></code> or a nice API package.</p>
<p>Never ever try #4 or #5 without searching for “&lt;website&gt; python api” first.</p>
</div>
</div>
<div class="section" id="a-scraping-toolkit">
<h1>A scraping toolkit<a class="headerlink" href="#a-scraping-toolkit" title="Permalink to this headline">¶</a></h1>
<div class="section" id="useful-packages-tricks-and-tips">
<h2>Useful packages, tricks, and tips<a class="headerlink" href="#useful-packages-tricks-and-tips" title="Permalink to this headline">¶</a></h2>
<p>Web scraping packages are always developing and evolving.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Task</p></th>
<th class="text-align:left head"><p>Thoughts</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>To “open” a page</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">urllib</span></code> or <code class="docutils literal notranslate"><span class="pre">requests</span></code>. <code class="docutils literal notranslate"><span class="pre">requests</span></code> is probably the best for sending API queries. <br> <br> Warning: lots of walkthroughs online use <code class="docutils literal notranslate"><span class="pre">urllib2</span></code>, which worked for Python2 but not Python3. Use <code class="docutils literal notranslate"><span class="pre">urllib</span></code> instead, and you might have to include a few tweaks. For example, if you see <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">urllib2</span> <span class="pre">import</span> <span class="pre">urlopen</span></code> replace it with from <code class="docutils literal notranslate"><span class="pre">urllib.request</span> <span class="pre">import</span> <span class="pre">urlopen</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>To parse a page</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">beautifulsoup</span></code>, <code class="docutils literal notranslate"><span class="pre">lxml</span></code>, or <code class="docutils literal notranslate"><span class="pre">pyquery</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Combining opening/parsing</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">requests_html</span></code> is a relatively new package and might be excellent. Its code is simply a combination of many of the above.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Blocked because you look like a bot?</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">selenium</span></code> is one way to “impersonate” a human, and also can help develop scraping macros, but you might not need it except on difficult scraping projects. It opens a literal browser window. <br> <br> <code class="docutils literal notranslate"><span class="pre">requests_html</span></code> and <code class="docutils literal notranslate"><span class="pre">requests</span></code> can also store and use cookies. I’d recommend you try this before selenium.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Blocked because you’re sending requests too fast?</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">time</span> <span class="pre">import</span> <span class="pre">sleep</span></code> allows you to <code class="docutils literal notranslate"><span class="pre">sleep(&lt;#</span> <span class="pre">of</span> <span class="pre">seconds&gt;)</span></code> your code.</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Wonder what your current HTML looks like?</p></td>
<td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">IPython.display</span> <span class="pre">import</span> <span class="pre">HTML</span></code> then <code class="docutils literal notranslate"><span class="pre">HTML(&lt;html</span> <span class="pre">object&gt;)</span></code> will show you what the HTML you have looks like. <br> E.g. if you’re using <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">=</span> <span class="pre">requests(url)</span></code>, then you can use <code class="docutils literal notranslate"><span class="pre">HTML(r.text)</span></code> to see the request object.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>How do I find a particular “piece” of a webpage</p></td>
<td class="text-align:left"><p>E.g. Q: Where is that table? <br> A: Oh, it’s inside the HTML tag called “table3”. <br> <br> You can search for elements via attributes, CSS selectors, XPath, and text. This will make more sense next class. <br> <br> To find that info: Right click on an element you’re interested and click “Inspect Element”. (F12 is the Windows shortcut.)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="my-suggestion">
<h2>My suggestion<a class="headerlink" href="#my-suggestion" title="Permalink to this headline">¶</a></h2>
<p>This is subject to change, but <strong>I think you should pick ONE opening and ONE parsing module and stick with it <em>for now</em></strong>. <code class="docutils literal notranslate"><span class="pre">requests_html</span></code> is a pretty good option that opens pages and can parse them, and it allows you to use <code class="docutils literal notranslate"><span class="pre">lxml</span></code>, or <code class="docutils literal notranslate"><span class="pre">pyquery</span></code> within it.</p>
<p>You can change and try other stuff as you go, but get as familiar with one package as you can (in a cheap/efficient way).</p>
<p>Now to contradict myself: Some of the packages above can’t do things others can, or do them much slower, or the code is hard to write, read, and debug. Sometimes, you’re holding a hammer but you need a screwdriver. What I’m saying is, if another package can easily do the job, use it. (Just realize that learning a new package comes with a fixed cost, so be sure you need that screwdriver before grabbing it.)</p>
</div>
<div class="section" id="what-skills-do-i-need-to-learn-to-be-a-master-hacker-wo-man">
<h2>What skills do I need to learn to be a master Hacker(wo)man?<a class="headerlink" href="#what-skills-do-i-need-to-learn-to-be-a-master-hacker-wo-man" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>How to open/read a webpage, and pass specific queries to a server</p></li>
<li><p>How to parse a (single) page, to find specific elements of interest (like tables, specific text, URLs)</p></li>
<li><p>Doing that for a large number of webpages (building a “scraper” or “crawler” or “spider”)</p>
<ul class="simple">
<li><p>monitor progress (<code class="docutils literal notranslate"><span class="pre">tqdm</span></code>)</p></li>
<li><p>deal with and log errors</p></li>
<li><p>slow down</p></li>
<li><p>passing cookies and API tokens if needed</p></li>
<li><p>building a directory to store the pages/data from webpages</p></li>
<li><p>doing this in a repo without uploading it all to GitHub (<code class="docutils literal notranslate"><span class="pre">.gitignore</span></code>)</p></li>
</ul>
</li>
</ol>
<p>So let’s start building up those skills through demos and practice!</p>
</div>
</div>
<div class="section" id="skill-1-retrieving-urls-and-sending-manual-api-queries">
<h1>Skill #1: Retrieving URLs and sending manual API queries<a class="headerlink" href="#skill-1-retrieving-urls-and-sending-manual-api-queries" title="Permalink to this headline">¶</a></h1>
<ol class="simple">
<li><p>Prof led: <a class="reference external" href="https://nbviewer.jupyter.org/github/nealcaren/ScrapingData/blob/master/Notebooks/5_APIs.ipynb">The Neal Caren “First API” example</a></p>
<ul class="simple">
<li><p><strong>JSON is just a data storage structure, and in python it’s a dictionary.</strong> We make the search give us JSON because it can be easier to extract data from JSON than HTML sometimes.</p></li>
<li><p>You look for whats in a dictionary with <code class="docutils literal notranslate"><span class="pre">dict.keys()</span></code> and then <code class="docutils literal notranslate"><span class="pre">dict['key']</span></code> will show you the value/object belonging to the key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pd.DataFrame()</span></code> can convert a dictionary to a data frame</p></li>
</ul>
</li>
<li><p>For your reference: Sometimes a webpage is “hiding” an API. You run a search and the URL doesn’t look obviously like a search. But often, inside that page is a “backdoor” to an API you can search just like the above example. <a class="reference external" href="https://nbviewer.jupyter.org/github/nealcaren/ScrapingData/blob/master/Notebooks/Bonus_Undocument_APIs.ipynb">This</a> tutorial shows one example of this and more importantly, how the author found the API.</p></li>
<li><p>YOUR TURN: Exchange rates</p>
<ul class="simple">
<li><p>Start with <code class="docutils literal notranslate"><span class="pre">url</span> <span class="pre">=</span> <span class="pre">'https://api.exchangeratesapi.io/latest?base=NOK'</span> </code></p></li>
<li><p>Q1: What is the average exchange rate value this search returns?</p></li>
<li><p><a class="reference external" href="https://exchangeratesapi.io/">The documentation</a> for this database (how to search it, change parameters, etc.)</p></li>
<li><p>Q2: Change the base to Euros, then tell me how many Japanese Yen is in a euro.</p></li>
<li><p>Q3: What was the number of Yen per Euro on Jan 2, 2018?</p></li>
<li><p>Q4: Bonus, prof can show: Get a time series of EURJPY from 2018 through 2019.</p></li>
</ul>
</li>
<li><p>AFTER CLASS PRACTICE:</p>
<ul class="simple">
<li><p>Rewrite our code for Q1-Q4 using <code class="docutils literal notranslate"><span class="pre">requests_html</span></code> to the extent possible. If and when you succeed, email your solution to me!</p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="skill-2-how-to-parse-a-single-page">
<h1>Skill 2: How to parse a (single) page<a class="headerlink" href="#skill-2-how-to-parse-a-single-page" title="Permalink to this headline">¶</a></h1>
<p>You might parse a page to</p>
<ul class="simple">
<li><p>isolate the data/text/urls you need</p></li>
<li><p>find a link to collect (or click!)</p></li>
</ul>
<p>Data on page is typically HTML, XML, or JSON.</p>
<ol class="simple">
<li><p><strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation (JSON)</p></li>
<li><p>e<strong>X</strong>tensible <strong>M</strong>arkup <strong>L</strong>anguage (XML)</p></li>
<li><p>HTML - for <span class="xref myst">example</span>.</p></li>
</ol>
<p>You can right click on a page and “view source” to see the underlying HTML, XML, or JSON.</p>
<ul class="simple">
<li><p>Go to the <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_S%26P_500_companies">S&amp;P500 wiki page</a></p></li>
<li><p>Right click and view the source. See the structure? That’s HTML!</p></li>
</ul>
<p>From <a class="reference external" href="https://en.wikipedia.org/wiki/HTML">Wikipedia</a>:</p>
<blockquote>
<div><p>HTML markup consists of several key components, including those called tags (and their attributes), character-based data types, character references and entity references. HTML tags most commonly come in pairs like <code class="docutils literal notranslate"><span class="pre">&lt;h1&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;/h1&gt;</span></code>, although some represent empty elements and so are unpaired, for example <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code>. The first tag in such a pair is the start tag, and the second is the end tag (they are also called opening tags and closing tags).</p>
<p>Another important component is the HTML document type declaration, which triggers standards mode rendering.</p>
<p>The following is an example of the classic “Hello, World!” program:</p>
<div class="highlight-HTML notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>This is a title<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world!<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>Elements can nest inside elements (a paragraph within the body of the page, the title inside the header, the rows inside the table with columns inside them).</p>
<div class="section" id="practice">
<h2>Practice<a class="headerlink" href="#practice" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://flukeout.github.io/">Let’s play a game</a> about finding and selecting elements using the html tags.</p>
</div>
<div class="section" id="practice-challenge-get-a-list-of-wiki-pages-for-s-p500-firms">
<h2>Practice/challenge: Get a list of wiki pages for S&amp;P500 firms<a class="headerlink" href="#practice-challenge-get-a-list-of-wiki-pages-for-s-p500-firms" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Revisit the S&amp;P 500 wiki: <code class="docutils literal notranslate"><span class="pre">pd.read_html('https://en.wikipedia.org/wiki/List_of_S%26P_500_companies')</span></code></p></li>
<li><p>Let’s try to grab all the URLs. Notice the <code class="docutils literal notranslate"><span class="pre">pd.read_html</span></code> approach can’t do this.</p></li>
<li><p>Use your browser’s Inspector to find info you can use to select the table, and then we will try to extract the URLs.</p></li>
</ul>
</div>
<div class="section" id="after-class-practice">
<h2>AFTER CLASS PRACTICE<a class="headerlink" href="#after-class-practice" title="Permalink to this headline">¶</a></h2>
<p>I really, really like the tutorials Greg Reda wrote (<a class="reference external" href="http://www.gregreda.com/2013/03/03/web-scraping-101-with-python/">here</a> and <a class="reference external" href="http://www.gregreda.com/2013/04/29/more-web-scraping-with-python/">here</a>). See the caveat about <code class="docutils literal notranslate"><span class="pre">urllib2</span></code> above, but otherwise this code works. Greg uses <code class="docutils literal notranslate"><span class="pre">urllib</span></code> to open and <code class="docutils literal notranslate"><span class="pre">beautifulsoup</span></code> to parse, but if you want to, you should be able to rewrite his code using <code class="docutils literal notranslate"><span class="pre">requests_html</span></code> pretty easily. When you succeed, please email me!</p>
</div>
</div>
<div class="section" id="skill-3-building-a-scraper">
<h1>Skill #3: Building a scraper<a class="headerlink" href="#skill-3-building-a-scraper" title="Permalink to this headline">¶</a></h1>
<p>We can open a page, pass an API query, and parse a page for the elements we’re interested in.</p>
<div class="section" id="one-api-hit-is-cool-but-do-you-know-whats-really-cool">
<h2>One API hit is cool, but  do you know whats really cool?<a class="headerlink" href="#one-api-hit-is-cool-but-do-you-know-whats-really-cool" title="Permalink to this headline">¶</a></h2>
<p>One million API hits.</p>
<p><img alt="" src="https://media.giphy.com/media/sEULHciNa7tUQ/giphy.gif" /></p>
<p>Ok, maybe not a million.* But now that you can write a <code class="docutils literal notranslate"><span class="pre">request</span></code> and modify search parameters, you might need to run a bunch of searches.</p>
<p>Scraping jobs typically fall into one of two camps:</p>
<ol class="simple">
<li><p>loop over URLs (predetermined list)</p></li>
<li><p>navigate from an initial page through subsequent pages (e.g through search results)</p></li>
</ol>
<p>Of course, both can be true: sometimes a scraper might have a list of URLs (search for crime 1, then crime 2) and for each URL (crime) click through all result pages.</p>
<p><strong>When your job falls into the first camp - you want to loop over a list of URLs - a good way to do that is</strong>: Define a function to do one search, then call that for each search in a list of searches.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">search_itunes</span><span class="p">(</span><span class="n">search_term</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Simplified iTunes search&#39;&#39;&#39;</span>
    
    <span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;https://itunes.apple.com/search&#39;</span>
    <span class="n">search_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;term&#39;</span><span class="p">:</span> <span class="n">search_term</span><span class="p">}</span>
    
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">search_parameters</span><span class="p">)</span>
    
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;results&#39;</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">results_df</span>

<span class="n">search_itunes</span><span class="p">(</span><span class="s1">&#39;billie eilish&#39;</span><span class="p">)</span>      <span class="c1"># one search at a time</span>
<span class="n">search_itunes</span><span class="p">(</span><span class="s1">&#39;father john misty&#39;</span><span class="p">))</span> <span class="c1"># &quot;another one&quot; - dj khaled</span>

<span class="n">artists</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;billie eilish&#39;</span><span class="p">,</span><span class="s1">&#39;father john misty&#39;</span><span class="p">]</span> <span class="c1"># you can loop over them!</span>

<span class="c1"># download the results and save locally</span>
<span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">search_itunes</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span>
    <span class="c1"># you could do anything with the results here</span>
    <span class="c1"># a good idea in many projects: save the webpage/search results</span>
    <span class="c1"># even better: add the saving function inside the &quot;search_itunes&quot; fcn</span>
    <span class="c1"># but this is just a toy illustration, so nothing happens</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> 
    
<span class="c1"># LATER, you will want to analyze those files. Just loop over the files again:</span>
<span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
    <span class="c1"># load the saved file</span>
    <span class="c1"># call a function you wrote to parse one file</span>
    <span class="c1"># do something with the output from the parser</span>
    <span class="c1"># but this is just a toy illustration, so nothing happens    </span>
    <span class="k">pass</span>   
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="the-main-web-scraping-problems-and-workarounds">
<h1>The main web scraping problems (and workarounds)<a class="headerlink" href="#the-main-web-scraping-problems-and-workarounds" title="Permalink to this headline">¶</a></h1>
<p>Also, again, check out  table above on useful packages and tips.</p>
<div class="section" id="issue-1-the-jobs-are-slow">
<h2>Issue 1:  The jobs are slow<a class="headerlink" href="#issue-1-the-jobs-are-slow" title="Permalink to this headline">¶</a></h2>
<p>In many web scraping projects, a lot of data needs to get scraped, over thousands (or millions) (or billions) of pages. It’s unlikely that you can do this all in one session. (What if your WiFi disconnects, or Windows decides to do an update, or the webpage freezes you out for a period of time?)</p>
<p><strong>Solutions:</strong></p>
<ol>
<li><p><strong>Write code that only hits the server one time</strong>, and saves the results to your computer. “Step 1” of the <code class="docutils literal notranslate"><span class="pre">search_itunes</span></code> example above does that. Then “step 2” uses/parses those files without going to the webpages again.</p></li>
<li><p><strong>You want your spider to resume, not restart.</strong> Ensure that your code can resume where it left off without having to restart from scratch. My usual solution:</p>
<div class="highlight-PYTHON notranslate"><div class="highlight"><pre><span></span><span class="c1"># as I&#39;m looping over webpages:</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="o">&lt;</span><span class="n">filename</span> <span class="n">this</span> <span class="n">page</span> <span class="n">would</span> <span class="n">get</span><span class="o">&gt;</span><span class="p">):</span> 
    <span class="n">okay_do_the_download</span><span class="p">()</span> <span class="c1"># whatever the function is</span>
<span class="c1"># if not, skip to the next webpage</span>
</pre></div>
</div>
</li>
<li><p>Your spider WILL fail - you don’t want it to stop. I typically use a <code class="docutils literal notranslate"><span class="pre">try-except-else</span></code> block. The <code class="docutils literal notranslate"><span class="pre">try</span></code> part accesses the url/send the API request, the <code class="docutils literal notranslate"><span class="pre">except</span></code> part prints or logs a failure to a log file, and the <code class="docutils literal notranslate"><span class="pre">else</span></code> part only executes the code I need to run after the url request if the <code class="docutils literal notranslate"><span class="pre">try</span></code> code was successful. For example, I could improve the <code class="docutils literal notranslate"><span class="pre">search_itunes</span></code> function:</p>
<div class="highlight-PYTHON notranslate"><div class="highlight"><pre><span></span>if not os.path.exists(&lt;filename this page would get&gt;): 
    try:
        r = requests.get(base_url, params = search_parameters)
    except:
        print(&quot;hey this didn&#39;t work! prob print better info than&quot;)
        print(&quot;this string&quot;)
        # or... create strings and append them to an &quot;error_list&quot;,
        # which you save to a text file or csv after the code finishes
        # and you can look at it then
    else:
        results_df = pd.DataFrame(r.json()[&#39;results&#39;])
    ```        
</pre></div>
</div>
</li>
<li><p>Your spider WILL fail - you will want to know what. You should log failures, warnings, and errors. The prior example can be adjusted to do this well.</p></li>
</ol>
</div>
<div class="section" id="issue-2-too-much-speed">
<h2>Issue 2: Too much speed<a class="headerlink" href="#issue-2-too-much-speed" title="Permalink to this headline">¶</a></h2>
<p>Servers aren’t free and can get overloaded. You’ve seen or heard of websites crashing due to high traffic - <a class="reference external" href="https://www.blazemeter.com/blog/biggest-web-failures-2016-and-2017-resolutions/">Fandango for Star Wars - Rogue One, Black Fridays, and the Canadian Immigration site in Nov 2016</a>.</p>
<p>As such, webmasters often throttle or block computers that are sending too much traffic.</p>
<p><strong>Solutions:</strong></p>
<ol class="simple">
<li><p>Slow your code down with <code class="docutils literal notranslate"><span class="pre">sleep(#)</span></code>. This is the main solution.</p></li>
<li><p>Get API access with special permissions.</p></li>
<li><p>If you can’t slow down your spider (the code crawling the site), use multiple computers/IP addresses</p></li>
</ol>
</div>
<div class="section" id="issue-3-so-i-m-downloading-a-loooot-of-files">
<h2>Issue 3: So… I’m downloading a loooot of files<a class="headerlink" href="#issue-3-so-i-m-downloading-a-loooot-of-files" title="Permalink to this headline">¶</a></h2>
<p>You are!</p>
<p>It’s important to save them in an organized way. There is no “one way”, and the directory/storage scheme I choose depends on the job. The main thing is that you probably want two abilities ater the download:</p>
<ol class="simple">
<li><p>If you sequentially open all files, can you tell what they are? (E.g. the firm, the year, the form type.)</p></li>
<li><p>If you want to only open some files, can you do that without opening all files? (E.g. only open 10-Ks but not 10-Qs.)</p></li>
</ol>
<p>How you achieve these is somewhat up to you but you basically have two choices (and these can work in tandom):</p>
<p><strong>Solution 1: Build the folder structure so that the path to the file tells you what you need to know.</strong></p>
<p>E.g. <code class="docutils literal notranslate"><span class="pre">/gvkey_10145/10-ks/2008/934573495-923875934.txt</span></code> is “obviously” the 2008 10-K for firm 10145, and you know this without needing to open the file and even though the filename itself is not very clear.</p>
<p><strong>Solution 2: Keep a master list of documents</strong></p>
<p>Sometimes it’s not possible or reasonable to know exactly how to build the directory in advance. For example, forms filed to the SEC in 2008 are often for fiscal year 2007. So what does the “2008” folder mean? How can you tell before running everything? So maybe you just download all the 10-ks for that firm inside the <code class="docutils literal notranslate"><span class="pre">/gvkey_10145/10-ks/</span></code> folder.</p>
<p>To find the 2008 10-K, you’d open up a master list of documents which contains variables with enough info to assemble the path to each file, and info about each file. Then you can <code class="docutils literal notranslate"><span class="pre">query(&quot;form='10-K'</span> <span class="pre">&amp;</span> <span class="pre">fyear=2008&quot;)</span></code>, assemble the filename, and run your code.</p>
<p>This master list must either be assembled before you run your spider (like in Assignment 5), as you run the spider (collect the info and save it as you go), or after the download you run some code one time to assemble it (either using their paths a la <code class="docutils literal notranslate"><span class="pre">/gvkey_10145/10-ks/2008/934573495-923875934.txt</span></code>, or open every single file to extract the info about the document).</p>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>You can combine all this discussion into a “general structure” for spiders. For each page you want to visit, you need to know</p>
<ol class="simple">
<li><p>The URL</p></li>
<li><p>The folder and filename you want to save it to</p></li>
</ol>
<p>And then, for each page you want to visit:</p>
<div class="highlight-PYTHON notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="o">&lt;</span><span class="n">filename</span> <span class="n">this</span> <span class="n">page</span> <span class="n">would</span> <span class="n">get</span><span class="o">&gt;</span><span class="p">):</span> 
    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">&lt;</span><span class="n">the</span> <span class="n">url</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># log the error somehow</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># save the results, I typically save the RAW source</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># be nice to server</span>
</pre></div>
</div>
</div>
<div class="section" id="would-you-like-another-tutorial-to-try">
<h2>Would you like another tutorial to try?<a class="headerlink" href="#would-you-like-another-tutorial-to-try" title="Permalink to this headline">¶</a></h2>
<p>Again, Greg Reda has a nice <a class="reference external" href="https://nbviewer.jupyter.org/github/nealcaren/ScrapingData/blob/master/Notebooks/Bonus_Downloading.ipynb">walkthrough</a> discussing building a robust code to download a list, and incorporates many of the elements in code we’ve talked about.</p>
</div>
<div class="section" id="id1">
<h2>Practice<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Start a “repo” - this time I just mean a folder inside the participation folder, but treat it like a standalone repo - and inside it, crawl all the S&amp;P 500 firms’ wiki pages.</p>
</div>
</div>
<div class="section" id="footnotes">
<h1>Footnotes<a class="headerlink" href="#footnotes" title="Permalink to this headline">¶</a></h1>
<p>* <em>I’ve done well over a million API hits in the name of science.</em></p>
</div>
<div class="section" id="credits">
<h1>Credits<a class="headerlink" href="#credits" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>STAT545, as always</p></li>
<li><p><a class="reference external" href="https://nealcaren.org/">Neal Caren</a></p></li>
</ul>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content/04/old"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Prof. Donald Bowen<br/>
        
            &copy; Copyright 2020.<br/>
          <div class="extra_footer">
            You're doing well, keep going!
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>