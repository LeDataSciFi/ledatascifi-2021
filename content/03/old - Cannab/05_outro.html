
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wrangling Outro &#8212; LeDataSciFi-2021</title>
    
  <link rel="stylesheet" href="../../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/fin377_specialformatting.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../index.html">
  
  <img src="../../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">LeDataSciFi-2021</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  About the class
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/objectives.html">
   Objectives
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/outcomes.html">
   Outcomes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/about_us.html">
   About us + office hours
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/structure_and_policies.html">
   Course structure + policies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/gradeoverview.html">
   Grading
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/acknowledgments.html">
   Gratitude
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Schedule, tips, resources
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/schedule.html">
   Dashboard, key links, schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/resources.html">
   Help + resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../about/tips.html">
   Tips and hacks
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Assignments and participation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/howto_do.html">
   How to start and turn in assignments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/howto_review.html">
   How to do your peer reviews
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Textbook
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../01/00_Getting_Started.html">
   1. Motivation and Getting Started
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/01_Motivation.html">
     1.1. Motivation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/02_Setup.html">
     1.2. Set up
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/03_github.html">
     1.3. Github Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/04_Markdown.html">
     1.4. Markdown basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/05_jupyterlab.html">
     1.5. Jupyter Lab Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/06_python.html">
     1.6. Python Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/07_debugging.html">
     1.7. Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/07a_errors.html">
     1.8. Errors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/08_libraries.html">
     1.9. Installing libraries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01/09_gitignore.html">
     1.10. Gitignore Files
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../02/10_Golden_1.html">
   2. Good Analysis Practices
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../02/10_Golden_2.html">
     2.1. A case study of bad research
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02/10_Golden_3.html">
     2.2. The golden rules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02/10_Golden_4.html">
     2.3. Good data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02/10_Golden_5.html">
     2.4. When to write functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02/10_Golden_6.html">
     2.5. Reorganizing the bad research folder
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02/10_Golden_7.html">
     2.6. Filepaths
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../00_Data_Wrangling_Intro.html">
   3. Wrangling with Data
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../01_Numpy.html">
     3.1. Numpy
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../01a_NumpyCS.html">
       3.1.1. Numpy + Scientific Computing
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../01b_NumpyBasics.html">
       3.1.2. A (Very) Short Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../01c_NumpyPractice.html">
       3.1.3. Exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../01d_NumpyResources.html">
       3.1.4. More Resources
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../01d_NumpyResources.html#survey">
       3.1.5. Survey
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../02a_pandasIntro.html">
     3.2. Pandas
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../02a_pandasTips.html">
       3.2.1. Tips
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../02b_pandasVocab.html">
       3.2.2. Vocab and Long vs Wide Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../02c_commonFcns.html">
       3.2.3. Common Functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../02d_temp.html">
       3.2.4. Temp. vs Perm. Objects
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../02e_eda_golden.html">
       3.2.5. Golden Rules + EDA
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../02f_chains.html">
       3.2.6. Pandas Chains
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../02g_commontasks.html">
       3.2.7. Common Tasks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../02h_exercises.html">
       3.2.8. Exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../02j_resourcesAndSum.html">
       3.2.9. Summary and Resources
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../04a-dataviz.html">
     3.3. Data Visualization
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../04b-whyplot.html">
       3.3.1. The Role of Viz in Analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../04c-makeplot.html">
       3.3.2. Making a Plot
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../04d-whichplot.html">
       3.3.3. Which Plot Type Should I Use?
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../04e-visualEDA.html">
       3.3.4. Visual EDA
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../04f-betterplots.html">
       3.3.5. Better Plots
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/content/03/old - Cannab/05_outro.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/LeDataSciFi/ledatascifi-2021"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/LeDataSciFi/ledatascifi-2021/issues/new?title=Issue%20on%20page%20%2Fcontent/03/old - Cannab/05_outro.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/LeDataSciFi/ledatascifi-2021/edit/main/content/03/old - Cannab/05_outro.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/LeDataSciFi/ledatascifi-2021/main?urlpath=lab/tree/content/03/old - Cannab/05_outro.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/LeDataSciFi/ledatascifi-2021/blob/main/content/03/old - Cannab/05_outro.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#merging">
   Merging
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-nice-overview">
     A nice overview
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#important-parameters-of-pd-merge">
     Important parameters of
     <code class="docutils literal notranslate">
      <span class="pre">
       pd.merge
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#good-merging-habits">
     Good merging habits
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dealing-with-missing-values">
   Dealing With Missing Values
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#options">
     Options
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="wrangling-outro">
<h1>Wrangling Outro<a class="headerlink" href="#wrangling-outro" title="Permalink to this headline">¶</a></h1>
<p><strong>Context - our goals were:</strong> Remember, the class’s <a class="reference external" href="https://ledatascifi.github.io/">objectives</a> are to:</p>
<blockquote>
<div><ol class="simple">
<li><p>obtain, explore, groom, visualize, and analyze data</p></li>
<li><p>make all of that reproducible, reusable, and shareable</p></li>
</ol>
</div></blockquote>
<p><img alt="" src="https://media.giphy.com/media/R2m2NzVxQ3pbG/giphy.gif" /></p>
<p><strong>Context - so far:</strong> At this point, we’re in the ballpark for all of that! In fact, if you recall the lengthier objectives, the “data: cleaning, exploring, visualizing and organizing” one said:</p>
<blockquote>
<div><p>Some data will be given to you and well organized, but much of the data that will be given to you will be poorly organized. So we need to know how to explore it (both to clean it and learn from it). Tables will help you understand data, but visuals are usually better. [Plus], we are going to learn good dataset habits.</p>
</div></blockquote>
<p><img alt="" src="https://media.giphy.com/media/xUOxfh6ZM75efM3Bqo/giphy.gif" /></p>
<p>At this point, you’ve added skills</p>
<ul class="simple">
<li><p>GitHub for collaboration (issues on peer reviews and discussion board) and sharing (forking your peer’s repos)</p></li>
<li><p>GitHub for project management/development and version control</p></li>
<li><p>Python: numpy, pandas, seaborn, matplotlib</p></li>
<li><p>Datasets: CRSP (stock prices), Compustat (firm financial statements), FRED, Data.World</p></li>
<li><p>Data scraping: Yes, you’ve done this already!</p></li>
<li><p>Finance: Factor-loading estimates (“A Simple Program” and its sequel)</p></li>
</ul>
<p>We need to talk about a few more issues before we get properly ambitious.</p>
<p><img alt="" src="https://media.giphy.com/media/kdFujikoYAdfgQQVrs/giphy.gif" /></p>
<p><strong>Context - going forward:</strong> We need to introduce a few more skills before we start <em>really</em> running analytical models.</p>
<ol class="simple">
<li><p>Merging datasets</p></li>
<li><p>What to do with missing values?</p></li>
<li><p>How to get a world of data off the world wide web</p></li>
<li><p>Strings</p></li>
</ol>
<p>Today, we will talk about those first two topics: Merging, and Dealing With Missing Values.</p>
<div class="section" id="merging">
<h2>Merging<a class="headerlink" href="#merging" title="Permalink to this headline">¶</a></h2>
<p>You’ve already merged datasets. But so far, our examples have been “well-behaved” so it was easy to just proceed. But real world datasets are messy (bad variable names, poor documentation) and big, and so merging isn’t always as easy as “just do it”.</p>
<div class="section" id="a-nice-overview">
<h3>A nice overview<a class="headerlink" href="#a-nice-overview" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://jakevdp.github.io/PythonDataScienceHandbook/03.07-merge-and-join.html">Python Data Science Handbook</a> has a wonderful breakdown of the mechanics of merging. You should read it!</p>
</div>
<div class="section" id="important-parameters-of-pd-merge">
<h3>Important parameters of <code class="docutils literal notranslate"><span class="pre">pd.merge</span></code><a class="headerlink" href="#important-parameters-of-pd-merge" title="Permalink to this headline">¶</a></h3>
<p>Read through the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html">parameters of the function here</a>.</p>
<p><strong>Key functions:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">right</span></code>, <code class="docutils literal notranslate"><span class="pre">left</span></code> - your datasets</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on</span></code> - a single variable or a list of variables you’re matching</p>
<ul>
<li><p>if the variable names aren’t the same in the datasets (e.g. “ID” in one and “identity” in the other), use <code class="docutils literal notranslate"><span class="pre">left_on</span></code> and <code class="docutils literal notranslate"><span class="pre">right_on</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">how</span></code> =</p>
<ul>
<li><p>“inner” –&gt; obs in both datasets</p></li>
<li><p>“left” –&gt; inner + all unmatched obs in left</p></li>
<li><p>“right” (inner + all unmatched obs in right), right, outer</p></li>
<li><p>“left” (inner + all unmatched obs in left), right, outer</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">suffix</span></code> = when a variable is in both datasets, how should we name each.</p>
<ul>
<li><p>**It’s a good idea to always use this option and specific the source, because the default option is uninformative! **</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">indicator=True</span></code> will create a variable saying which dataset the variable came from</p></li>
</ul>
<p><strong>How many observations will my merge produce?</strong></p>
<p>It depends on <code class="docutils literal notranslate"><span class="pre">how</span></code> you merge the datasets. But also, any time you merge datasets, you should think about the variables you’re merging <code class="docutils literal notranslate"><span class="pre">on</span></code> (the “keys”) and ask:</p>
<ol class="simple">
<li><p>Is it 1 observation per key in one, both, or neither?</p></li>
<li><p>Am I doing 1:1, 1:M, M:1, or M:M merge? The differences are huge!</p></li>
<li><p>Related: What’s the “observation level” before and after? Which variables will be at different levels?</p></li>
<li><p>Is the key ever empty in either datasets?</p></li>
</ol>
<p>Copy the datasets below. Let’s try merging different combinations and see what happens.</p>
<p>Let’s also see what happens when we repeat a merge or try to merge in a dataset with a variable of the same name.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1"># this &quot;firm&quot; variable is really &quot;last firm&quot; but the database manager called it what they called it </span>
<span class="c1"># and now IT is scared that fixing it will break all their systems, so it&#39;s &quot;stuck as-is&quot;</span>
<span class="n">some_employees</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;employee&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;Jake&#39;</span><span class="p">,</span> <span class="s1">&#39;Lisa&#39;</span><span class="p">,</span> <span class="s1">&#39;Sue&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;firm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Citi&#39;</span><span class="p">,</span><span class="s1">&#39;GS&#39;</span><span class="p">,</span><span class="s1">&#39;Accenture&#39;</span><span class="p">,</span><span class="s1">&#39;Wells Fargo&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;group&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Accounting&#39;</span><span class="p">,</span> <span class="s1">&#39;Engineering&#39;</span><span class="p">,</span> <span class="s1">&#39;Engineering&#39;</span><span class="p">,</span> <span class="s1">&#39;HR&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;hire_date&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2004</span><span class="p">,</span> <span class="mi">2008</span><span class="p">,</span> <span class="mi">2012</span><span class="p">,</span> <span class="mi">2014</span><span class="p">]})</span>

<span class="n">departments</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;group&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Accounting&#39;</span><span class="p">,</span> <span class="s1">&#39;Engineering&#39;</span><span class="p">,</span> <span class="s1">&#39;HR&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;employees&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">})</span>

<span class="n">current_employer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;employee&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;Jake&#39;</span><span class="p">,</span> <span class="s1">&#39;Lisa&#39;</span><span class="p">,</span> <span class="s1">&#39;Sue&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;firm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Yahoo&#39;</span><span class="p">,</span><span class="s1">&#39;Yahoo&#39;</span><span class="p">,</span><span class="s1">&#39;Yahoo&#39;</span><span class="p">,</span><span class="s1">&#39;Yahoo&#39;</span><span class="p">],</span>

<span class="n">some_employees_alt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;employee&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Jonathan&#39;</span><span class="p">,</span> <span class="s1">&#39;Mary&#39;</span><span class="p">,</span> <span class="s1">&#39;Lisa&#39;</span><span class="p">,</span> <span class="s1">&#39;Sue&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;firm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;?&#39;</span><span class="p">,</span><span class="s1">&#39;Lehigh&#39;</span><span class="p">,</span><span class="s1">&#39;Accenture&#39;</span><span class="p">,</span><span class="s1">&#39;Wells Fargo&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;group&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Accounting&#39;</span><span class="p">,</span> <span class="s1">&#39;CEO&#39;</span><span class="p">,</span> <span class="s1">&#39;Engineering&#39;</span><span class="p">,</span> <span class="s1">&#39;HR&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;hire_date&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="mi">2012</span><span class="p">,</span> <span class="mi">2014</span><span class="p">]})</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="good-merging-habits">
<h3>Good merging habits<a class="headerlink" href="#good-merging-habits" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Specify <code class="docutils literal notranslate"><span class="pre">how</span></code> and <code class="docutils literal notranslate"><span class="pre">suffix</span></code>.</p></li>
<li><p>Before the merge think about (1) the observation levels in the left and right (2) <code class="docutils literal notranslate"><span class="pre">how</span></code> you’re merging and (3) whether you think the merge is 1:1, 1:M, M:M, or M:1. Guess how many observations you’ll have (more or less than left? more or less than right or left?) and then check afterwards.</p></li>
<li><p>Look at the data! <em>(Example: In the golden rules lecture “Good and Bad Data” example, if we merged the firm-level data to the firm-year level data, check that “GM“‘s first year is matched to all annual observations for GM.)</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">describe()</span></code> the data and look at “count” for each variable (and also <code class="docutils literal notranslate"><span class="pre">isnull().sum()</span></code> to count missing observations). Does the count make sense?</p>
<ul class="simple">
<li><p>Repeat this for each section of the merged dataset (the observations from the left data, from the right data, and from both). For example,  <code class="docutils literal notranslate"><span class="pre">df.query('_merge</span> <span class="pre">!=</span> <span class="pre">&quot;right_only&quot;).describe()</span></code> will describe the merged dataset’s observations from the left data.</p></li>
</ul>
</li>
<li><p>Going forward, remember the new observation level. I often actively name the dataframe to remind myself exactly that. For example, I know exactly how <code class="docutils literal notranslate"><span class="pre">state_industry_year_df</span></code> and <code class="docutils literal notranslate"><span class="pre">state_industry_df</span></code> should differ.</p></li>
</ol>
</div>
</div>
<div class="section" id="dealing-with-missing-values">
<h2>Dealing With Missing Values<a class="headerlink" href="#dealing-with-missing-values" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df.isnull().sum</span></code> will report missing values by variable.</p></li>
<li><p>With new datasets, look out for “missing values” that aren’t missing. Some datasets use a certain number to indicate missing data (i.e. -99). Convert these to NaNs with <code class="docutils literal notranslate"><span class="pre">replace</span></code>.</p></li>
</ol>
<p><a class="reference external" href="https://github.com/matthewbrems/ODSC-missing-data-may-18/blob/master/Analysis%20with%20Missing%20Data.pdf">These slides</a> on missing data are quite good! <a class="reference external" href="https://www.geeksforgeeks.org/working-with-missing-data-in-pandas/">This article</a> has examples too.</p>
<p><strong>You should focus on the whys and hows of dealing with missing data rather than mechanics.</strong>
(You can look up mechanics later.)</p>
<p>For example, with firm level data that investment analysts deal with, the most common approach is to keep all valid data, and for each test you run, use all observations that have no missing values for the variables of interest. In the slides, this is called “Complete-Case Analysis”.</p>
<p>It is less common in my field of research to impute missing values. However, “Deductive imputation” is common
when the cost of doing so isn’t high.</p>
<p>In general, when you can confidently deduce a value (my height this year is the same as last year because I’m a fully grown adult (mostly)), go ahead.  That is valid data.</p>
<div class="section" id="options">
<h3>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fillna</span></code> - any value (strings included) you want, back fill, forward, fill, and more</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dropna</span></code> - might not be explicitly needed, some functions ignore NaNs, but some don’t. I tend to drop only as needed for a given estimation, and only temporarily.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">replace</span></code> - some datasets use a certain number to indicate missing data (i.e. -99). Convert these to NaN with this function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">interpolate</span></code> - e.g. use values in surrounding time periods to fill in gaps</p></li>
<li><p>Deduce. Suppose PPE this year is missing. <span class="math notranslate nohighlight">\(PPE_t = PPE_{t-1} + CAPX_t - DP_t \)</span></p></li>
</ul>
<p>Copy the following code into your live code and we can try a few things:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="p">:[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
                   <span class="s2">&quot;B&quot;</span><span class="p">:[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> 
                   <span class="s2">&quot;C&quot;</span><span class="p">:[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> 
                   <span class="s2">&quot;D&quot;</span><span class="p">:[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">6</span><span class="p">]})</span> 
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content/03/old - Cannab"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Prof. Donald Bowen<br/>
        
            &copy; Copyright 2020.<br/>
          <div class="extra_footer">
            You're doing well, keep going!
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>